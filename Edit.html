<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แก้ไขกิจกรรม - PBNTC Activity System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <style>
        /* CSS เฉพาะสำหรับหน้านี้ (ใช้โค้ดเดิมที่คุณสร้างไว้) */
        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            gap: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 250px;
        }
        .form-group input, .form-group select {
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
            width: 100%;
        }
        .required::before {
            content: '*';
            color: #d9534f;
            margin-right: 5px;
        }
        .time-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .create-button {
            background-color: #5bc0de;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }
        /* เพิ่มสไตล์สำหรับไอคอนใน input */
        .input-icon-group {
            position: relative;
            width: 100%;
        }
        .input-icon-group input {
            padding-right: 35px;
        }
        .input-icon-group i {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
            pointer-events: none;
        }
       .attendance-table {
    border-collapse: collapse;
    width: 100%;
    font-family: Arial, sans-serif;
}

.attendance-table th, .attendance-table td {
    text-align: center;
    padding: 8px 5px;
}

.attendance-table tbody tr:nth-child(odd) {
    background-color: #fff;
}
.attendance-table tbody tr:nth-child(even) {
    background-color: #f2f2f2;
}

.attendance-table thead th {
    border-bottom: 2px solid #333;
}

/* ซ่อน radio button จริง */
.attendance-table input[type="radio"] {
    display: none;
}

/* ปุ่ม default ว่าง */
.attendance-table label {
    display: inline-block;
    width: 40px;
    height: 30px;
    border: 2px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
    position: relative;
}
/* กำหนดสีกรอบตามประเภทปุ่มแต่ละประเภท */
.attendance-table label.present-btn {
    border-color: green; /* มา */
}

.attendance-table label.late-btn {
    border-color: goldenrod; /* สาย */
}

.attendance-table label.absent-btn {
    border-color: red; /* ขาด */
}

/* สีเมื่อเลือก */
input[type="radio"]:checked + label.present-btn {
    background-color: green;
    border-color: green;
}
input[type="radio"]:checked + label.late-btn {
    background-color: #f1c40f; /* พื้นเหลือง */
    border-color: goldenrod;
    color: white; /* สี text ภายใน label (ถ้าใช้ ::after) */
    position: relative; /* เพื่อให้ ::after จัดตำแหน่งได้ */
}
input[type="radio"]:checked + label.absent-btn {
    background-color: red;
    border-color: red;
}

/* เพิ่มเครื่องหมายถูกเมื่อเลือก */
input[type="radio"]:checked + label::after {
    content: "✔";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
    font-size: 16px;
}

/* ปรับสีตัวเครื่องหมายถูกสำหรับสาย (พื้นเหลือง) */
input[type="radio"]:checked + label.late-btn::after {
    content: "✔";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white; /* สีเครื่องหมายถูก */
    font-weight: bold;
    font-size: 16px;
    z-index: 1; /* ให้เหนือพื้นหลัง */
    pointer-events: none; /* ไม่ขัดกับการคลิก */
}
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-area">
            <img src="https://example.com/pbntc-logo.png" alt="PBNTC Logo" class="logo">
            PBNTC
        </div>
    </div>
    
    <div class="main-container">
        <div class="sidebar">
            <nav>
                <a href="index.html"><i class="fas fa-home"></i> หน้าหลัก</a>
                <a href="create_activity.html" class="active"><i class="fas fa-edit"></i> สร้างกิจกรรม</a>
                <a href="edit_delete_activity.html"><i class="fas fa-list-alt"></i> แก้ไข / ลบกิจกรรม</a>
                <a href="#"><i class="fas fa-clipboard-check"></i> ตรวจสอบกิจกรรม</a>
                <a href="#"><i class="fas fa-building"></i> ข้อมูลแผนก</a>
                <a href="summary.html"><i class="fas fa-poll"></i> สรุปผลเทอม</a>
                <a href="#" class="logout"><i class="fas fa-sign-out-alt"></i> ลงชื่อเข้าใช้ออก</a>
            </nav>
        </div>

        <div class="content">
            <h2 class="page-title">แก้ไขกิจกรรม</h2>

            <form id="createActivityForm">
                <div class="form-row">
                    <div class="form-group" style="width: 100%;">
                        <label for="activityName" class="required">ชื่อกิจกรรม</label>
                        <input type="text" id="activityName" name="activityName" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="activityDate" class="required">วันที่จัดกิจกรรม</label>
                        <div class="input-icon-group">
                            <input type="text" id="activityDate" name="activityDate" placeholder="วว/ดด/ปปปป" required>
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                    </div>

                    <div class="form-group" style="flex: 2;">
                        <label class="required">เวลา</label>
                        <div class="time-group">
                            <div class="input-icon-group">
                                <input type="time" id="startTime" name="startTime" required>
                                <i class="fas fa-clock"></i>
                            </div>
                            <span>*ถึง</span>
                            <div class="input-icon-group">
                                <input type="time" id="endTime" name="endTime" required>
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="department" class="required">แผนก</label>
                        <div class="input-icon-group">
                            <select id="department" name="department" required>
                                <option value="">เลือกแผนก</option>
                                <option value="1">ไฟฟ้า</option>
                                <option value="2">ช่างยนต์</option>
                            </select>
                            <i class="fas fa-check"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="level" class="required">ระดับ</label>
                        <div class="input-icon-group">
                            <select id="level" name="level" required>
                                <option value="">เลือกระดับ</option>
                                <option value="ปวช.">ปวช.</option>
                                <option value="ปวส.">ปวส.</option>
                                <option value="ปริญญาตรี">ปริญญาตรี</option>
                            </select>
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group" style="flex: unset; width: 300px; flex-direction: row; align-items: center;">
                        <label for="recurringDays" style="width: 100px; font-weight: normal; margin-right: 10px;">จัดขึ้นทุกๆ</label>
                        <input type="number" id="recurringDays" name="recurringDays" value="0" style="width: 80px;">
                        <span style="font-weight: bold; margin-left: 10px;">วัน</span>
                    </div>
                </div>
            <div>
    <table class="attendance-table">
        <thead>
            <tr>
                <th>ชื่อ</th>
                <th>รหัสนักศึกษา</th>
                <th>มา</th>
                <th>สาย</th>
                <th>ขาด</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>640101</td>
                <td>
                    <input type="radio" name="status1" id="present1" value="present">
                    <label for="present1" class="present-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status1" id="late1" value="late">
                    <label for="late1" class="late-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status1" id="absent1" value="absent">
                    <label for="absent1" class="absent-btn"></label>
                </td>
            </tr>
            <tr>
                <td>2</td>
                <td>640102</td>
                <td>
                    <input type="radio" name="status2" id="present2" value="present">
                    <label for="present2" class="present-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status2" id="late2" value="late">
                    <label for="late2" class="late-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status2" id="absent2" value="absent">
                    <label for="absent2" class="absent-btn"></label>
                </td>
            </tr>
            <tr>
                <td>3</td>
                <td>640103</td>
                <td>
                    <input type="radio" name="status3" id="present3" value="present">
                    <label for="present3" class="present-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status3" id="late3" value="late">
                    <label for="late3" class="late-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status3" id="absent3" value="absent">
                    <label for="absent3" class="absent-btn"></label>
                </td>
            </tr>
        </tbody>
    </table>
</div>

                <button type="submit" class="create-button">บันทึก</button>

            </form>
        </div>
    </div>
    <script>
        // เรียกใช้ flatpickr สำหรับ date picker
        flatpickr("#activityDate", {
            dateFormat: "d/m/Y",
            locale: "th"
        });
    </script>
    <script type="module">
// ตัวอย่าง Supabase v2
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const SUPABASE_URL = 'https://pdqzkejlefozxquptoco.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBkcXprZWpsZWZvenhxdXB0b2NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNDIyODAsImV4cCI6MjA3NzkxODI4MH0.EojnxNcGPj7eGlf7FAJOgMuEXIW54I2NQwB_L2Wj9DU';
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

// ดึงค่า activityId จาก URL
const params = new URLSearchParams(window.location.search)
const activityId = params.get('activityId')

async function loadActivity() {
    // 1. ดึงข้อมูล activity พร้อม join กับ department
    const { data, error } = await supabase
        .from('activity')
        .select(`
            id,
            name,
            start_time,
            end_time,
            is_recurring,
            department:department_id (id, name, level)
        `)
        .eq('id', activityId)
        .single()

    if (error) {
        console.error(error)
        return
    }

    // 2. ใส่ข้อมูลลงฟอร์ม
    document.getElementById('activityName').value = data.name
    document.getElementById('activityDate').value = new Date(data.start_time).toLocaleDateString('th-TH')
    document.getElementById('startTime').value = new Date(data.start_time).toISOString().slice(11,16)
    document.getElementById('endTime').value = new Date(data.end_time).toISOString().slice(11,16)
    document.getElementById('recurringDays').value = data.is_recurring ? 1 : 0

    // 3. โหลด dropdown ของแผนกทั้งหมด
    const { data: depts, error: deptError } = await supabase
        .from('department')
        .select('id, name, level')
        .order('name')

    if (deptError) {
        console.error(deptError)
        return
    }

    const deptSelect = document.getElementById('department')
    deptSelect.innerHTML = '<option value="">เลือกแผนก</option>'

    depts.forEach(d => {
        const option = document.createElement('option')
        option.value = d.id
        option.textContent = `${d.name} (${d.level})`
        deptSelect.appendChild(option)
    })

    // 4. เลือกค่า department ของ activity
    if (data.department) {
        deptSelect.value = data.department.id
        document.getElementById('level').value = data.department.level
    }
}

// เรียกเมื่อโหลดหน้า
document.addEventListener('DOMContentLoaded', loadActivity)

</script>

</body>
</html>