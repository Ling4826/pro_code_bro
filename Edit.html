<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° - PBNTC Activity System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <style>
        /* CSS ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ (‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ) */
        /* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô */
body {
    margin: 0;
    font-family: Tahoma, sans-serif;
    background-color: #f4f4f4;
}

/* Header (‡πÅ‡∏ñ‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏µ‡∏™‡πâ‡∏°) */
.header {
    background-color: #d9534f; /* ‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏≠‡∏°‡πÅ‡∏î‡∏á */
    color: white;
    padding: 10px 20px;
    height: 60px; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ logo ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö sidebar */
    box-sizing: border-box;
}

.logo-area {
    font-size: 24px;
    font-weight: bold;
    display: flex;
    align-items: center;
}

.logo {
    width: 40px;
    height: 40px;
    margin-right: 10px;
    border-radius: 50%;
    /* ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏à‡∏£‡∏¥‡∏á */
}

/* ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (Sidebar + Content) */
.main-container {
    display: flex;
    min-height: calc(100vh - 60px); /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ ‡∏•‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á Header */
}

/* Sidebar (‡πÅ‡∏ñ‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏™‡∏µ‡∏î‡∏≥) */
.sidebar {
    width: 200px;
    background-color: #333; /* ‡∏™‡∏µ‡∏î‡∏≥/‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏° */
    color: white;
    padding-top: 20px;
    flex-shrink: 0;
}

.sidebar a {
    display: block;
    color: #ccc;
    padding: 15px 20px;
    text-decoration: none;
    border-left: 5px solid transparent;
    transition: all 0.2s;
}

.sidebar a:hover {
    color: white;
    background-color: #444;
}

.sidebar a.Edit_Active {
    color: white;
    background-color: #444;
    border-left-color: #d9534f; /* ‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ */
}

.sidebar a i {
    margin-right: 10px;
    width: 20px; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô */
}

/* Content (‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å) */
.content {
    flex-grow: 1;
    padding: 40px;
    background-color: white;
}

/* ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤ */
.time-display {
    text-align: center;
    font-size: 18px;
    color: #666;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
}

/* Function Grid (‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô) */
.function-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 3 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
    gap: 30px;
    max-width: 900px;
    margin: 0 auto;
}

/* Function Block (‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏≠‡∏±‡∏ô) */
.function-block {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 180px;
    text-align: center;
    color: white;
    font-size: 20px;
    font-weight: bold;
    border-radius: 8px;
    text-decoration: none;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.function-block:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

.function-block i {
    font-size: 60px;
    margin-bottom: 15px;
}

/* --- Styles for Confirmation Dialog (Modal) --- */

/* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ Dialog ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏î‡∏≥‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á */
    display: flex; 
    justify-content: center;
    align-items: center;
    z-index: 1000; 
}

/* ‡∏ï‡∏±‡∏ß Modal ‡∏´‡∏•‡∏±‡∏Å */
.modal-dialog {
    background-color: white;
    border-radius: 4px;
    width: 450px; 
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    overflow: hidden;
}

/* ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß (‡∏™‡∏µ‡∏™‡πâ‡∏°) */
.modal-header {
    background-color: #f0ad4e; /* ‡∏™‡∏µ‡∏™‡πâ‡∏° */
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 18px;
    font-weight: bold;
}

.modal-header h3 {
    margin: 0;
}

.modal-header .close-btn {
    font-size: 24px;
    cursor: pointer;
    line-height: 1;
}

/* ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ */
.modal-body {
    padding: 30px 20px;
    text-align: center;
    font-size: 16px;
    color: #333;
}

.modal-body #activityToDeleteName {
    color: #d9534f; /* ‡πÄ‡∏ô‡πâ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏µ‡πÅ‡∏î‡∏á */
    font-weight: bold;
}

/* ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢ (‡∏õ‡∏∏‡πà‡∏°) */
.modal-footer {
    padding: 15px 20px;
    text-align: right;
    display: flex;
    justify-content: center; 
    gap: 20px;
}

/* üìå Styles ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏°‡∏µ‡∏™‡∏µ) */
.btn {
    padding: 10px 25px;
    border: none;
    border-radius: 4px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.2s;
    font-weight: bold;
}

.btn-cancel {
    background-color: #5bc0de; /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ */
    color: white;
}

.btn-confirm {
    background-color: #d9534f; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á */
    color: white;
}

/* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á */
.function-block.blue { background-color: #337ab7; } /* ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° - ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ */
.function-block.red { background-color: #d9534f; }    /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° */
.function-block.green { background-color: #5cb85c; }  /* ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° - ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
.function-block.orange { background-color: #f0ad4e; } /* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤ */
.function-block.purple { background-color: #673ab7; } /* ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÄ‡∏ó‡∏≠‡∏° */


/* *** START: CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤) ***
*/

.page-title { /* ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô .content-header */
    font-size: 26px;
    font-weight: bold;
    margin-bottom: 20px;
    color: #333; /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ò‡∏µ‡∏°‡∏´‡∏•‡∏±‡∏Å */
}

/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
.data-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    text-align: left;
}

.data-table th, .data-table td {
    padding: 10px 12px;
    border: 1px solid #ddd;
    font-size: 15px;
}

.data-table th {
    background-color: #f2f2f2;
    color: #333;
    font-weight: 600;
    text-align: center;
    border-bottom: 2px solid #ccc;
}

.data-table tr:nth-child(even) {
    background-color: #f7f7f7;
}

/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°/‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
.pass { color: #5cb85c; font-weight: 600; } /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
.fail { color: #d9534f; font-weight: 600; } /* ‡πÅ‡∏î‡∏á */
.role-select { width: 120px; padding: 5px; border-radius: 4px; } /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Department_information.html */

/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Filter / Search */
.filter-controls {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    align-items: center;
}

.filter-controls input[type="text"], 
.filter-controls select {
    padding: 8px 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 15px;
    box-sizing: border-box;
}

.search-box {
    position: relative;
    flex: 1; /* ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î */
}

.search-box input {
    width: 100%;
    padding-left: 35px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô */
}

.search-box i {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #777;
}

.filter-controls label {
    font-weight: bold;
    white-space: nowrap;
}

/* *** END: CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤) ***
*/
        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            gap: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 250px;
        }
        .form-group input, .form-group select {
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
            width: 100%;
        }
        .required::before {
            content: '*';
            color: #d9534f;
            margin-right: 5px;
        }
        .time-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .create-button {
            background-color: #5bc0de;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏ô input */
        .input-icon-group {
            position: relative;
            width: 100%;
        }
        .input-icon-group input {
            padding-right: 35px;
        }
        .input-icon-group i {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
            pointer-events: none;
        }
       .attendance-table {
    border-collapse: collapse;
    width: 100%;
    font-family: Arial, sans-serif;
}

.attendance-table th, .attendance-table td {
    text-align: center;
    padding: 8px 5px;
}

.attendance-table tbody tr:nth-child(odd) {
    background-color: #fff;
}
.attendance-table tbody tr:nth-child(even) {
    background-color: #f2f2f2;
}

.attendance-table thead th {
    border-bottom: 2px solid #333;
}

/* ‡∏ã‡πà‡∏≠‡∏ô radio button ‡∏à‡∏£‡∏¥‡∏á */
.attendance-table input[type="radio"] {
    display: none;
}

/* ‡∏õ‡∏∏‡πà‡∏° default ‡∏ß‡πà‡∏≤‡∏á */
.attendance-table label {
    display: inline-block;
    width: 40px;
    height: 30px;
    border: 2px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
    position: relative;
}
/* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó */
.attendance-table label.present-btn {
    border-color: green; /* ‡∏°‡∏≤ */
}

.attendance-table label.late-btn {
    border-color: goldenrod; /* ‡∏™‡∏≤‡∏¢ */
}

.attendance-table label.absent-btn {
    border-color: red; /* ‡∏Ç‡∏≤‡∏î */
}

/* ‡∏™‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
input[type="radio"]:checked + label.present-btn {
    background-color: green;
    border-color: green;
}
input[type="radio"]:checked + label.late-btn {
    background-color: #f1c40f; /* ‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á */
    border-color: goldenrod;
    color: white; /* ‡∏™‡∏µ text ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô label (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ ::after) */
    position: relative; /* ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ ::after ‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ */
}
input[type="radio"]:checked + label.absent-btn {
    background-color: red;
    border-color: red;
}

/* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
input[type="radio"]:checked + label::after {
    content: "‚úî";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
    font-size: 16px;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏¢ (‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á) */
input[type="radio"]:checked + label.late-btn::after {
    content: "‚úî";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white; /* ‡∏™‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å */
    font-weight: bold;
    font-size: 16px;
    z-index: 1; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
    pointer-events: none; /* ‡πÑ‡∏°‡πà‡∏Ç‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å */
}
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-area">
            <img src="https://example.com/pbntc-logo.png" alt="PBNTC Logo" class="logo">
            PBNTC
        </div>
    </div>
    
    <div class="main-container">
        <div class="sidebar">
            <nav>
                <a href="index.html"><i class="fas fa-home"></i> ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <a href="create_activity.html" ><i class="fas fa-edit"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a>
                <a href="edit_delete_activity.html" class="Edit_Active"><i class="fas fa-list-alt"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a>
                <a href="#"><i class="fas fa-clipboard-check"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a>
                <a href="#"><i class="fas fa-building"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤</a>
                <a href="summary.html"><i class="fas fa-poll"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÄ‡∏ó‡∏≠‡∏°</a>
                <a href="#" class="logout"><i class="fas fa-sign-out-alt"></i> ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏Å</a>
            </nav>
        </div>

        <div class="content">
            <h2 class="page-title">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>

            <form id="createActivityForm">
                <div class="form-row">
                    <div class="form-group" style="width: 100%;">
                        <label for="activityName" class="required">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                        <input type="text" id="activityName" name="activityName" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="activityDate" class="required">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                        <div class="input-icon-group">
                            <input type="text" id="activityDate" name="activityDate" placeholder="‡∏ß‡∏ß/‡∏î‡∏î/‡∏õ‡∏õ‡∏õ‡∏õ" required>
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                    </div>

                    <div class="form-group" style="flex: 2;">
                        <label class="required">‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <div class="time-group">
                            <div class="input-icon-group">
                                <input type="time" id="startTime" name="startTime" required>
                                <i class="fas fa-clock"></i>
                            </div>
                            <span>*‡∏ñ‡∏∂‡∏á</span>
                            <div class="input-icon-group">
                                <input type="time" id="endTime" name="endTime" required>
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="department" class="required">‡∏™‡∏≤‡∏Ç‡∏≤</label>
                        <div class="input-icon-group">
                            <select id="department" name="department" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>
                                <option value="1">‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</option>
                                <option value="2">‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå</option>
                            </select>
                            <i class="fas fa-check"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="level" class="required">‡∏£‡∏∞‡∏î‡∏±‡∏ö</label>
                        <div class="input-icon-group">
                            <select id="level" name="level" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö</option>
                                <option value="‡∏õ‡∏ß‡∏ä.">‡∏õ‡∏ß‡∏ä.</option>
                                <option value="‡∏õ‡∏ß‡∏™.">‡∏õ‡∏ß‡∏™.</option>
                            </select>
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                        <div class="form-group">
                            <label for="semester" class="required">‡πÄ‡∏ó‡∏≠‡∏°</label>
                            <select id="semester" name="semester" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ó‡∏≠‡∏°</option>
                                <option value="1">‡πÄ‡∏ó‡∏≠‡∏° 1</option>
                                <option value="2">‡πÄ‡∏ó‡∏≠‡∏° 2</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="studentYear" class="required">‡∏õ‡∏µ</label>
                            <select id="studentYear" name="studentYear" required>
                                <option value>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ</option>
                            </select>
                        </div>
                    </div>
                <div class="form-row">
                    <div class="form-group" style="flex: unset; width: 300px; flex-direction: row; align-items: center;">
                        <label for="recurringDays" style="width: 100px; font-weight: normal; margin-right: 10px;">‡∏à‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ</label>
                        <input type="number" id="recurringDays" name="recurringDays" value="0" style="width: 80px;">
                        <span style="font-weight: bold; margin-left: 10px;">‡∏ß‡∏±‡∏ô</span>
                    </div>
                </div>
            <div>
    <table class="attendance-table">
        <thead>
            <tr>
                <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                <th>‡∏°‡∏≤</th>
                <th>‡∏™‡∏≤‡∏¢</th>
                <th>‡∏Ç‡∏≤‡∏î</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>640101</td>
                <td>
                    <input type="radio" name="status1" id="present1" value="present">
                    <label for="present1" class="present-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status1" id="late1" value="late">
                    <label for="late1" class="late-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status1" id="absent1" value="absent">
                    <label for="absent1" class="absent-btn"></label>
                </td>
            </tr>
            <tr>
                <td>2</td>
                <td>640102</td>
                <td>
                    <input type="radio" name="status2" id="present2" value="present">
                    <label for="present2" class="present-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status2" id="late2" value="late">
                    <label for="late2" class="late-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status2" id="absent2" value="absent">
                    <label for="absent2" class="absent-btn"></label>
                </td>
            </tr>
            <tr>
                <td>3</td>
                <td>640103</td>
                <td>
                    <input type="radio" name="status3" id="present3" value="present">
                    <label for="present3" class="present-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status3" id="late3" value="late">
                    <label for="late3" class="late-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status3" id="absent3" value="absent">
                    <label for="absent3" class="absent-btn"></label>
                </td>
            </tr>
        </tbody>
    </table>
</div>

                <button type="submit" class="create-button">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>

            </form>
        </div>
    </div>
    <script>
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ flatpickr ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö date picker
        flatpickr("#activityDate", {
            dateFormat: "d/m/Y",
            locale: "th"
        });
    </script>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const SUPABASE_URL = 'https://pdqzkejlefozxquptoco.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBkcXprZWpsZWZvenhxdXB0b2NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNDIyODAsImV4cCI6MjA3NzkxODI4MH0.EojnxNcGPj7eGlf7FAJOgMuEXIW54I2NQwB_L2Wj9DU';
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

const params = new URLSearchParams(window.location.search)
const activityId = params.get('activityId')

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• activity
async function loadActivity() {
    // 1. ‡πÇ‡∏´‡∏•‡∏î activity
    const { data: activity, error } = await supabase
        .from('activity')
        .select(`id, name, start_time, end_time, is_recurring, major:major_id (id,name,level)`)
        .eq('id', activityId)
        .single();

    if (error) { console.error(error); return }

    document.getElementById('activityName').value = activity.name;
    document.getElementById('activityDate').value = new Date(activity.start_time).toLocaleDateString('th-TH');
    document.getElementById('startTime').value = new Date(activity.start_time).toISOString().slice(11,16);
    document.getElementById('endTime').value = new Date(activity.end_time).toISOString().slice(11,16);
    document.getElementById('recurringDays').value = activity.is_recurring ? 1 : 0;

    // 2. ‡πÇ‡∏´‡∏•‡∏î major (‡∏™‡∏≤‡∏Ç‡∏≤)
    const { data: depts, error: deptError } = await supabase
        .from('major')
        .select('id,name,level')
        .order('name');

    if (deptError) { console.error(deptError); return }

    const deptSelect = document.getElementById('department');
    deptSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>';
    depts.forEach(d => {
        const option = document.createElement('option');
        option.value = d.id;
        option.textContent = `${d.name} (${d.level})`;
        deptSelect.appendChild(option);
    });

    if (activity.major) {
        deptSelect.value = activity.major.id;
        document.getElementById('level').value = activity.major.level;
    }

    // 3. ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    const majorId = activity.major ? activity.major.id : null;
    if (!majorId) return;

    const { data: students, error: studentError } = await supabase
        .from('student')
        .select('year')
        .eq('major_id', majorId);

    if (studentError) {
        console.error('Error fetching student years:', studentError);
        return;
    }

    // 4. ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏õ‡πá‡∏ô array unique
    // 4. ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏õ‡πá‡∏ô array unique
const studentYears = [...new Set(students.map(s => s.year))].sort();
console.log(`Loaded student years for major ${activity.major.name}:`, studentYears);

// 5. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï select ‡∏Ç‡∏≠‡∏á‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
const yearSelect = document.getElementById('studentYear');
yearSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ</option>'; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡πà‡∏≠‡∏ô
studentYears.forEach(y => {
    const option = document.createElement('option');
    option.value = y;
    option.textContent = y;
    yearSelect.appendChild(option);
});

// 6. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤ default
if (studentYears.length > 0) {
    yearSelect.value = studentYears[0];
}

}

async function fetchStudentYear() {
    console.log('Fetching Years...');

    const { data: years, error } = await supabase
        .from('student')
        .select('year');

    const yearSelect = document.getElementById('studentYear');
    if (error) {
        console.error('Error fetching Years:', error.message);
        yearSelect.innerHTML = '<option value="">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ</option>';
        return;
    }

    if (years && years.length > 0) {
        const uniqueYears = [...new Set(years.map(item => item.year))].sort();
        uniqueYears.forEach(y => {
            const option = document.createElement('option');
            option.value = y;
            option.textContent = y;
            yearSelect.appendChild(option);
        });
        console.log(`Years loaded successfully: ${uniqueYears.length} items`);
    } else {
        console.warn('No year data found');
    }
}
// ‡πÇ‡∏´‡∏•‡∏î attendance table
async function loadAttendanceTable() {
    const tableBody = document.querySelector('.attendance-table tbody')
    tableBody.innerHTML = ''

    const { data, error } = await supabase
        .from('activity_check')
        .select(`id,semester, student:student_id (id,name), status`)
        .eq('activity_id', activityId)
        .order('student_id', { ascending: true })

    if (error) { console.error(error); return }

    const statusMap = { 'Attended':'present', 'Excused':'late', 'Absent':'absent' }

    data.forEach((record, index) => {
        const row = document.createElement('tr')
        row.dataset.recordId = record.id  // ‡πÄ‡∏Å‡πá‡∏ö id ‡∏Ç‡∏≠‡∏á record ‡πÄ‡∏î‡∏¥‡∏°

        const studentName = record.student?.name || '-'
        const studentId = record.student?.id || '-'
        const status = statusMap[record.status] || ''
        document.getElementById('semester').value = record.semester
        row.innerHTML = `
            <td>${studentName}</td>
            <td>${studentId}</td>
            <td>
                <input type="radio" name="status${index}" id="present${index}" value="present" ${status==='present'?'checked':''}>
                <label for="present${index}" class="present-btn"></label>
            </td>
            <td>
                <input type="radio" name="status${index}" id="late${index}" value="late" ${status==='late'?'checked':''}>
                <label for="late${index}" class="late-btn"></label>
            </td>
            <td>
                <input type="radio" name="status${index}" id="absent${index}" value="absent" ${status==='absent'?'checked':''}>
                <label for="absent${index}" class="absent-btn"></label>
            </td>
        `
        tableBody.appendChild(row)
    })
}

// submit form
const form = document.getElementById('createActivityForm')
form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // 1. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
    const activityName = document.getElementById('activityName').value
    const activityDate = document.getElementById('activityDate').value
    const [day, month, year] = activityDate.split('/')
    const isoDate = `${year}-${month}-${day}`

    const startTime = document.getElementById('startTime').value
    const endTime = document.getElementById('endTime').value
    const start_time_iso = `${year}-${month}-${day}T${startTime}:00`
    const end_time_iso = `${year}-${month}-${day}T${endTime}:00`

    const majorId = document.getElementById('department').value
    const recurringDays = parseInt(document.getElementById('recurringDays').value)
    const semester = parseInt(document.getElementById('semester').value)
    const academicYear = parseInt(document.getElementById('studentYear').value)

    if (!semester || !academicYear) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ó‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤')
        return
    }

    // 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï activity
    const activityData = {
        name: activityName,
        start_time: start_time_iso,
        end_time: end_time_iso,
        for_student: true,
        for_leader: true,
        for_teacher: false,
        is_recurring: (recurringDays > 0) ? recurringDays : null,
        created_by: 1,
        major_id: parseInt(majorId, 10)
    };

    console.log('Activity Data to Update:', activityData);

    const { data: updatedActivity, error: updateError } = await supabase
        .from('activity')
        .update(activityData)
        .eq('id', activityId)
        .select('id')
        .single();

    if (updateError) {
        console.error('Supabase Update Error:', updateError);
        alert(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${updateError.message}`);
        return;
    }

    // 3. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï activity_check
    const rows = document.querySelectorAll('.attendance-table tbody tr')
    for (const [index,row] of Array.from(rows).entries()) {
        const recordId = row.dataset.recordId
        const statusInput = row.querySelector(`input[name="status${index}"]:checked`)
        const statusValue = statusInput ? statusInput.value : null
        if (!recordId || !statusValue) continue

        const statusMap = { present:'Attended', late:'Excused', absent:'Absent' }
        const formattedDate = `${year}-${month.padStart(2,'0')}-${day.padStart(2,'0')}`

        const { error } = await supabase
            .from('activity_check')
            .update({
                status: statusMap[statusValue],
                date: formattedDate,
                semester: semester,
                academic_year: academicYear
            })
            .eq('id', recordId)

        if (error) {
            console.error(error)
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: '+error.message)
            return
        }
    }

    alert('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!')
    await loadAttendanceTable()
})


// ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
document.addEventListener('DOMContentLoaded', async () => {
    await loadActivity()
    await fetchStudentYear()
    await loadAttendanceTable()
})
</script>


</body>
</html>