<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° - PBNTC Activity System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <style>
        /* CSS ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ (‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ) */
        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            gap: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 250px;
        }
        .form-group input, .form-group select {
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
            width: 100%;
        }
        .required::before {
            content: '*';
            color: #d9534f;
            margin-right: 5px;
        }
        .time-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .create-button {
            background-color: #5bc0de;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏ô input */
        .input-icon-group {
            position: relative;
            width: 100%;
        }
        .input-icon-group input {
            padding-right: 35px;
        }
        .input-icon-group i {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
            pointer-events: none;
        }
       .attendance-table {
    border-collapse: collapse;
    width: 100%;
    font-family: Arial, sans-serif;
}

.attendance-table th, .attendance-table td {
    text-align: center;
    padding: 8px 5px;
}

.attendance-table tbody tr:nth-child(odd) {
    background-color: #fff;
}
.attendance-table tbody tr:nth-child(even) {
    background-color: #f2f2f2;
}

.attendance-table thead th {
    border-bottom: 2px solid #333;
}

/* ‡∏ã‡πà‡∏≠‡∏ô radio button ‡∏à‡∏£‡∏¥‡∏á */
.attendance-table input[type="radio"] {
    display: none;
}

/* ‡∏õ‡∏∏‡πà‡∏° default ‡∏ß‡πà‡∏≤‡∏á */
.attendance-table label {
    display: inline-block;
    width: 40px;
    height: 30px;
    border: 2px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
    position: relative;
}
/* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó */
.attendance-table label.present-btn {
    border-color: green; /* ‡∏°‡∏≤ */
}

.attendance-table label.late-btn {
    border-color: goldenrod; /* ‡∏™‡∏≤‡∏¢ */
}

.attendance-table label.absent-btn {
    border-color: red; /* ‡∏Ç‡∏≤‡∏î */
}

/* ‡∏™‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
input[type="radio"]:checked + label.present-btn {
    background-color: green;
    border-color: green;
}
input[type="radio"]:checked + label.late-btn {
    background-color: #f1c40f; /* ‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á */
    border-color: goldenrod;
    color: white; /* ‡∏™‡∏µ text ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô label (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ ::after) */
    position: relative; /* ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ ::after ‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ */
}
input[type="radio"]:checked + label.absent-btn {
    background-color: red;
    border-color: red;
}

/* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
input[type="radio"]:checked + label::after {
    content: "‚úî";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
    font-size: 16px;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏¢ (‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á) */
input[type="radio"]:checked + label.late-btn::after {
    content: "‚úî";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white; /* ‡∏™‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å */
    font-weight: bold;
    font-size: 16px;
    z-index: 1; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
    pointer-events: none; /* ‡πÑ‡∏°‡πà‡∏Ç‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å */
}
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-area">
            <img src="https://example.com/pbntc-logo.png" alt="PBNTC Logo" class="logo">
            PBNTC
        </div>
    </div>
    
    <div class="main-container">
        <div class="sidebar">
            <nav>
                <a href="index.html"><i class="fas fa-home"></i> ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <a href="create_activity.html" class="active"><i class="fas fa-edit"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a>
                <a href="edit_delete_activity.html"><i class="fas fa-list-alt"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a>
                <a href="#"><i class="fas fa-clipboard-check"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a>
                <a href="#"><i class="fas fa-building"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤</a>
                <a href="summary.html"><i class="fas fa-poll"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÄ‡∏ó‡∏≠‡∏°</a>
                <a href="#" class="logout"><i class="fas fa-sign-out-alt"></i> ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏Å</a>
            </nav>
        </div>

        <div class="content">
            <h2 class="page-title">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>

            <form id="createActivityForm">
                <div class="form-row">
                    <div class="form-group" style="width: 100%;">
                        <label for="activityName" class="required">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                        <input type="text" id="activityName" name="activityName" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="activityDate" class="required">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                        <div class="input-icon-group">
                            <input type="text" id="activityDate" name="activityDate" placeholder="‡∏ß‡∏ß/‡∏î‡∏î/‡∏õ‡∏õ‡∏õ‡∏õ" required>
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                    </div>

                    <div class="form-group" style="flex: 2;">
                        <label class="required">‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <div class="time-group">
                            <div class="input-icon-group">
                                <input type="time" id="startTime" name="startTime" required>
                                <i class="fas fa-clock"></i>
                            </div>
                            <span>*‡∏ñ‡∏∂‡∏á</span>
                            <div class="input-icon-group">
                                <input type="time" id="endTime" name="endTime" required>
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="department" class="required">‡∏™‡∏≤‡∏Ç‡∏≤</label>
                        <div class="input-icon-group">
                            <select id="department" name="department" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>
                                <option value="1">‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</option>
                                <option value="2">‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå</option>
                            </select>
                            <i class="fas fa-check"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="level" class="required">‡∏£‡∏∞‡∏î‡∏±‡∏ö</label>
                        <div class="input-icon-group">
                            <select id="level" name="level" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö</option>
                                <option value="‡∏õ‡∏ß‡∏ä.">‡∏õ‡∏ß‡∏ä.</option>
                                <option value="‡∏õ‡∏ß‡∏™.">‡∏õ‡∏ß‡∏™.</option>
                                <option value="‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ</option>
                            </select>
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group" style="flex: unset; width: 300px; flex-direction: row; align-items: center;">
                        <label for="recurringDays" style="width: 100px; font-weight: normal; margin-right: 10px;">‡∏à‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ</label>
                        <input type="number" id="recurringDays" name="recurringDays" value="0" style="width: 80px;">
                        <span style="font-weight: bold; margin-left: 10px;">‡∏ß‡∏±‡∏ô</span>
                    </div>
                </div>
            <div>
    <table class="attendance-table">
        <thead>
            <tr>
                <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                <th>‡∏°‡∏≤</th>
                <th>‡∏™‡∏≤‡∏¢</th>
                <th>‡∏Ç‡∏≤‡∏î</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>640101</td>
                <td>
                    <input type="radio" name="status1" id="present1" value="present">
                    <label for="present1" class="present-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status1" id="late1" value="late">
                    <label for="late1" class="late-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status1" id="absent1" value="absent">
                    <label for="absent1" class="absent-btn"></label>
                </td>
            </tr>
            <tr>
                <td>2</td>
                <td>640102</td>
                <td>
                    <input type="radio" name="status2" id="present2" value="present">
                    <label for="present2" class="present-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status2" id="late2" value="late">
                    <label for="late2" class="late-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status2" id="absent2" value="absent">
                    <label for="absent2" class="absent-btn"></label>
                </td>
            </tr>
            <tr>
                <td>3</td>
                <td>640103</td>
                <td>
                    <input type="radio" name="status3" id="present3" value="present">
                    <label for="present3" class="present-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status3" id="late3" value="late">
                    <label for="late3" class="late-btn"></label>
                </td>
                <td>
                    <input type="radio" name="status3" id="absent3" value="absent">
                    <label for="absent3" class="absent-btn"></label>
                </td>
            </tr>
        </tbody>
    </table>
</div>

                <button type="submit" class="create-button">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>

            </form>
        </div>
    </div>
    <script>
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ flatpickr ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö date picker
        flatpickr("#activityDate", {
            dateFormat: "d/m/Y",
            locale: "th"
        });
    </script>
    <script type="module">
// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Supabase v2
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const SUPABASE_URL = 'https://pdqzkejlefozxquptoco.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBkcXprZWpsZWZvenhxdXB0b2NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNDIyODAsImV4cCI6MjA3NzkxODI4MH0.EojnxNcGPj7eGlf7FAJOgMuEXIW54I2NQwB_L2Wj9DU';
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

// ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ activityId ‡∏à‡∏≤‡∏Å URL
const params = new URLSearchParams(window.location.search)
const activityId = params.get('activityId')

async function loadActivity() {
    // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• activity ‡∏û‡∏£‡πâ‡∏≠‡∏° join ‡∏Å‡∏±‡∏ö department
    const { data, error } = await supabase
        .from('activity')
        .select(`
            id,
            name,
            start_time,
            end_time,
            is_recurring,
            major:major_id (id, name, level)
        `)
        .eq('id', activityId)
        .single()

    if (error) {
        console.error(error)
        return
    }

    // 2. ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
    document.getElementById('activityName').value = data.name
    document.getElementById('activityDate').value = new Date(data.start_time).toLocaleDateString('th-TH')
    document.getElementById('startTime').value = new Date(data.start_time).toISOString().slice(11,16)
    document.getElementById('endTime').value = new Date(data.end_time).toISOString().slice(11,16)
    document.getElementById('recurringDays').value = data.is_recurring ? 1 : 0

    // 3. ‡πÇ‡∏´‡∏•‡∏î dropdown ‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    const { data: depts, error: deptError } = await supabase
        .from('major')
        .select('id, name, level')
        .order('name')

    if (deptError) {
        console.error(deptError)
        return
    }

    const deptSelect = document.getElementById('department')
    deptSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>'

    depts.forEach(d => {
        const option = document.createElement('option')
        option.value = d.id
        option.textContent = `${d.name} (${d.level})`
        deptSelect.appendChild(option)
    })

    // 4. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤ department ‡∏Ç‡∏≠‡∏á activity
    if (data.department) {
        deptSelect.value = data.department.id
        document.getElementById('level').value = data.department.level
    }
}
const form = document.getElementById('createActivityForm')

form.addEventListener('submit', async (e) => {
    e.preventDefault() // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô reload ‡∏´‡∏ô‡πâ‡∏≤

    // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
    const name = document.getElementById('activityName').value
    const startTime = document.getElementById('startTime').value
    const endTime = document.getElementById('endTime').value
    const activityDate = document.getElementById('activityDate').value
    const departmentId = document.getElementById('department').value
    const level = document.getElementById('level').value
    const recurringDays = document.getElementById('recurringDays').value
    const studentId = document.getElementById('studentId').value   // üëà ‡πÄ‡∏û‡∏¥‡πà‡∏° input hidden ‡∏´‡∏£‡∏∑‡∏≠ select ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö student
    const status = document.getElementById('status').value         // üëà ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Attended / Absent / Excused

    // ‡πÅ‡∏õ‡∏•‡∏á date + time ‡πÄ‡∏õ‡πá‡∏ô timestamp ISO
    const [day, month, year] = activityDate.split('/')
    const startDateTime = new Date(`${year}-${month}-${day}T${startTime}:00`).toISOString()
    const endDateTime = new Date(`${year}-${month}-${day}T${endTime}:00`).toISOString()

    // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
    const { data: updatedActivity, error: updateError } = await supabase
        .from('activity')
        .update({
            name: name,
            start_time: startDateTime,
            end_time: endDateTime,
            is_recurring: recurringDays > 0,
            major_id: majorId
        })
        .eq('id', activityId)
        .select()

    if (updateError) {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ' + updateError.message)
        console.error(updateError)
        return
    }

    // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠ (attendance)
    const { data: checkData, error: checkError } = await supabase
        .from('activity_check')
        .upsert([   // ‡πÉ‡∏ä‡πâ upsert ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≥ (‡∏ï‡∏≤‡∏° unique key)
            {
                activity_id: activityId,
                student_id: studentId,
                status: status
            }
        ], { onConflict: 'activity_id,student_id,date' }) // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô insert ‡∏ã‡πâ‡∏≥

    if (checkError) {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠: ' + checkError.message)
        console.error(checkError)
        return
    }

    alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!')
    console.log('Updated Activity:', updatedActivity)
    console.log('Saved Check:', checkData)

    // redirect ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    // window.location.href = 'edit_delete_activity.html'
})


async function loadAttendanceTable() {
    const tableBody = document.querySelector('.attendance-table tbody');
    tableBody.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô

    // ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• activity_check ‡∏ó‡∏µ‡πà join ‡∏Å‡∏±‡∏ö student
    const { data, error } = await supabase
        .from('activity_check')
        .select(`
            id,
            student:student_id (
                id,
                name
            ),
            status
        `)
        .eq('activity_id', activityId)
        .order('student_id', { ascending: true });

    if (error) {
        console.error('Error loading attendance:', error);
        return;
    }

    // ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤ status ‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö radio ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡πÉ‡∏ô HTML
    const statusMap = {
        'Attended': 'present',
        'Excused': 'late',
        'Absent': 'absent'
    };

    // ‚úÖ ‡∏ß‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß
    data.forEach((record, index) => {
        const row = document.createElement('tr');

        const studentName = record.student?.name || '-';
        const studentId = record.student?.id || '-';
        const status = statusMap[record.status] || '';

        row.innerHTML = `
            <td>${studentName}</td>
            <td>${studentId}</td>
            <td>
                <input type="radio" name="status${index}" id="present${index}" value="present" ${status === 'present' ? 'checked' : ''}>
                <label for="present${index}" class="present-btn"></label>
            </td>
            <td>
                <input type="radio" name="status${index}" id="late${index}" value="late" ${status === 'late' ? 'checked' : ''}>
                <label for="late${index}" class="late-btn"></label>
            </td>
            <td>
                <input type="radio" name="status${index}" id="absent${index}" value="absent" ${status === 'absent' ? 'checked' : ''}>
                <label for="absent${index}" class="absent-btn"></label>
            </td>
        `;

        tableBody.appendChild(row);
    });
}

// ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à
document.addEventListener('DOMContentLoaded', async () => {
    await loadActivity();
    await loadAttendanceTable();
});

</script>

</body>
</html>